<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä½ çš„å¹´åº¦å…³é”®è¯</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 500px;
            text-align: center;
        }
        
        h1 {
            color: #333;
            margin-bottom: 40px;
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .input-section {
            margin-bottom: 30px;
        }
        
        .nickname-input {
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            outline: none;
            transition: border-color 0.3s;
        }
        
        .nickname-input:focus {
            border-color: #4a90e2;
        }
        
        .gender-section {
            margin-bottom: 40px;
        }
        
        .gender-title {
            font-size: 1.2rem;
            color: #555;
            margin-bottom: 20px;
        }
        
        .gender-options {
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        
        .gender-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
        }
        
        .gender-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid #eee;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            color: #777;
            margin-bottom: 8px;
            transition: all 0.3s;
        }
        
        .gender-option input[type="radio"] {
            display: none;
        }
        
        .gender-option input[type="radio"]:checked + .gender-circle {
            border-color: #4a90e2;
            background-color: #f0f8ff;
            color: #4a90e2;
            transform: scale(1.1);
        }
        
        .gender-label {
            font-size: 1rem;
            color: #666;
        }
        
        .submit-btn {
            background-color: #4a90e2;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(74, 144, 226, 0.2);
        }
        
        .submit-btn:hover {
            background-color: #3a7bc8;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(74, 144, 226, 0.3);
        }
        
        .submit-btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .result-page {
            display: none;
        }
        
        .keyword-box {
            background-color: #f8f9fa;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        
        .keyword {
            font-size: 2rem;
            color: #e74c3c;
            font-weight: bold;
            margin: 20px 0;
            padding: 10px;
            background-color: #fff;
            border-radius: 8px;
            border: 2px dashed #e74c3c;
        }
        
        .back-btn {
            background-color: #95a5a6;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.1rem;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 30px;
            transition: all 0.3s;
        }
        
        .back-btn:hover {
            background-color: #7f8c8d;
        }
        
        .page {
            width: 100%;
        }
        
        .input-hint {
            text-align: left;
            color: #999;
            font-size: 0.9rem;
            margin-top: 8px;
            margin-left: 5px;
        }
        
        .error-message {
            color: #e74c3c;
            margin-top: 10px;
            min-height: 20px;
        }

        /* åŠ å…¥ç¾¤æŒ‰é’®æ ·å¼ */
        .join-group-btn {
            position: relative;
            display: inline-block;
            margin-top: 20px;
            padding: 12px 25px;
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            font-weight: bold;
            text-decoration: none;
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1;
        }
        
        .join-group-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 20px rgba(0,0,0,0.15);
        }
        
        .join-group-btn:active {
            transform: translateY(1px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
        }
        
        .join-group-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #fad0c4 0%, #ff9a9e 100%);
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .join-group-btn:hover::before {
            opacity: 1;
        }
        
        /* å¼¹çª—æ ·å¼ */
        .popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 1000;
            text-align: center;
            max-width: 300px;
            animation: fadeIn 0.3s ease-out;
        }
        
        .popup p {
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .popup-close {
            background-color: #4a90e2;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translate(-50%, -60%); }
            to { opacity: 1; transform: translate(-50%, -50%); }
        }
        
        /* QQåè®®æ£€æµ‹æ ·å¼ */
        .qq-protocol-check {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1001;
        }
        
        .qq-protocol-box {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            max-width: 300px;
            text-align: center;
        }
        
        .emoji {
            display: inline-block;
            animation: bounce 1.5s infinite;
        }
        
        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-5px);
            }
        }
        
        .buttons-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 30px;
        }
        
        @media (max-width: 600px) {
            h1 {
                font-size: 2rem;
            }
            
            .gender-options {
                gap: 10px;
            }
            
            .gender-circle {
                width: 50px;
                height: 50px;
            }

            .join-group-btn {
                padding: 10px 20px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ç¬¬ä¸€é¡µï¼šè¾“å…¥é¡µé¢ -->
        <div class="page input-page" id="inputPage">
            <h1>ä½ çš„å¹´åº¦å…³é”®è¯</h1>
            
            <div class="input-section">
                <input type="text" class="nickname-input" id="nicknameInput" placeholder="è¯·è¾“å…¥ä½ çš„æ˜µç§°">
                <div class="input-hint">è¯·è¾“å…¥ä½ çš„æ˜µç§°ï¼Œç„¶åé€‰æ‹©æ€§åˆ«</div>
            </div>
            
            <div class="gender-section">
                <div class="gender-title">è¯·é€‰æ‹©æ€§åˆ«</div>
                <div class="gender-options">
                    <!-- ç”·æ€§é€‰é¡¹ -->
                    <label class="gender-option">
                        <input type="radio" name="gender" value="male">
                        <div class="gender-circle">â™‚</div>
                        <div class="gender-label">ç”·</div>
                    </label>
                    
                    <!-- å¥³æ€§é€‰é¡¹ -->
                    <label class="gender-option">
                        <input type="radio" name="gender" value="female">
                        <div class="gender-circle">â™€</div>
                        <div class="gender-label">å¥³</div>
                    </label>
                    
                    <!-- æœªçŸ¥é€‰é¡¹ -->
                    <label class="gender-option">
                        <input type="radio" name="gender" value="unknown">
                        <div class="gender-circle">?</div>
                        <div class="gender-label">æœªçŸ¥</div>
                    </label>
                </div>
            </div>
            
            <div class="error-message" id="errorMessage"></div>
            
            <div class="buttons-container">
                <button class="submit-btn" id="submitBtn" disabled>ç‚¹å‡»æŸ¥çœ‹</button>
                
                <!-- ç¬¬ä¸€é¡µçš„åŠ å…¥ç¾¤æŒ‰é’® -->
                <button class="join-group-btn" id="joinGroupBtn1">
                    <span class="emoji">ğŸ¤ª</span> ç‚¹æˆ‘åŠ å…¥æ²™é›•åˆ†äº«ç¾¤ <span class="emoji">ğŸ¤ª</span>
                </button>
            </div>
        </div>
        
        <!-- ç¬¬äºŒé¡µï¼šç»“æœé¡µé¢ -->
        <div class="page result-page" id="resultPage">
            <h1>ä½ çš„å¹´åº¦å…³é”®è¯</h1>
            
            <div class="keyword-box">
                <p style="font-size: 1.3rem; color: #555; margin-bottom: 20px;">
                    æ ¹æ®ä½ çš„é€‰æ‹©ï¼Œç³»ç»Ÿä¸ºä½ ç”Ÿæˆäº†ä¸“å±å¹´åº¦å…³é”®è¯ï¼š
                </p>
                <div class="keyword" id="keywordDisplay"></div>
                <p style="color: #777; margin-top: 20px; font-size: 1.1rem;">
                    å¿«åˆ†äº«ç»™ä½ çš„æœ‹å‹ä»¬çœ‹çœ‹å§ï¼
                </p>
            </div>

            <div class="buttons-container">
                <button class="back-btn" id="backBtn">è¿”å›é‡æ–°æµ‹è¯•</button>
                
                <!-- ç¬¬äºŒé¡µçš„åŠ å…¥ç¾¤æŒ‰é’® -->
                <button class="join-group-btn" id="joinGroupBtn2">
                    <span class="emoji">ğŸ¤ª</span> ç‚¹æˆ‘åŠ å…¥æ²™é›•åˆ†äº«ç¾¤ <span class="emoji">ğŸ¤ª</span>
                </button>
            </div>
        </div>
    </div>

    <!-- å¼¹çª— -->
    <div id="popup" class="popup" style="display: none;">
        <p>ç¾¤å· <strong>619629743</strong> å·²å¤åˆ¶åˆ°å‰ªè´´æ¿</p>
        <button class="popup-close" id="popupClose">ç¡®å®š</button>
    </div>

    <!-- QQåè®®æ£€æµ‹å¼¹çª— -->
    <div id="qqProtocolCheck" class="qq-protocol-check" style="display: none;">
        <div class="qq-protocol-box">
            <p>æ­£åœ¨æ‰“å¼€QQï¼Œè¯·ç¨å€™...</p>
        </div>
    </div>

    <script>
        // ========== é…ç½®å¸¸é‡ ==========
        const CONFIG = {
            QQ_GROUP_NUMBER: '619629743',
            QQ_SCHEME: 'mqqapi://card/show_pslcard?src_type=internal&version=1&uin=619629743&card_type=group&source=qrcode',
            QQ_UNIVERSAL_LINK: 'https://qm.qq.com/q/3iFnS9bwpq',
            QQ_TIMEOUT: 3000,
            POPUP_DURATION: 2000
        };

        // ========== å…³é”®è¯åº“ ==========
        const KEYWORD_LIBRARY = {
            male: [
                "æ°´ç¾¤æœºå™¨", "å²æ–™æ¬è¿å·¥", "ç©¶æå˜æ€", "è‹¦å‘½é¸³é¸¯", 
                "æ— èƒ½çš„ä¸ˆå¤«", "é¢œå€¼æ‹…å½“", "å°‘å¥³æ€æ‰‹", "é¹¿å®˜çˆ±å¥½è€…"
            ],
            female: [
                "æ°´ç¾¤æœºå™¨", "å²æ–™æ¬è¿å·¥", "ç©¶æå˜æ€", "è‹¦å‘½é¸³é¸¯", 
                "é¢œå€¼æ‹…å½“", "æ°”æ°›æ‹…å½“", "å¯çˆ±å¥³äºº", "æ— èƒ½çš„å¦»å­", "é»„é‡‘çŸ¿å·¥"
            ],
            unknown: [
                "æ°´ç¾¤æœºå™¨", "å²æ–™æ¬è¿å·¥", "æš–å¿ƒå¤©ä½¿", "é˜³å…‰å°é›¶", 
                "æŸ”æƒ…å°å—è‰¯", "è‹¦å‘½é¸³é¸¯", "æ°”æ°›æ‹…å½“", "é¢œå€¼æ‹…å½“", 
                "ç©¶æå˜æ€", "ç´«è–‡æ˜Ÿäºº"
            ]
        };

        // ========== DOM å…ƒç´ ç¼“å­˜ ==========
        const DOM = {
            nicknameInput: document.getElementById('nicknameInput'),
            genderRadios: document.querySelectorAll('input[name="gender"]'),
            submitBtn: document.getElementById('submitBtn'),
            errorMessage: document.getElementById('errorMessage'),
            inputPage: document.getElementById('inputPage'),
            resultPage: document.getElementById('resultPage'),
            keywordDisplay: document.getElementById('keywordDisplay'),
            backBtn: document.getElementById('backBtn'),
            popup: document.getElementById('popup'),
            popupClose: document.getElementById('popupClose'),
            qqProtocolCheck: document.getElementById('qqProtocolCheck')
        };

        // ========== å·¥å…·å‡½æ•° ==========
        
        /**
         * ä½¿ç”¨ SHA-256 ç”Ÿæˆå“ˆå¸Œï¼ˆå¼‚æ­¥ï¼‰
         */
        async function sha256Hash(str) {
            const encoder = new TextEncoder();
            const data = encoder.encode(str);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const view = new Uint8Array(hashBuffer);
            // ä½¿ç”¨å‰4ä¸ªå­—èŠ‚è½¬æ¢ä¸º32ä½æ•´æ•°
            return (view[0] << 24) | (view[1] << 16) | (view[2] << 8) | view[3];
        }

        /**
         * åŸºäºç”¨æˆ·åçš„ç¡®å®šæ€§éšæœºé€‰æ‹©ï¼ˆå¼‚æ­¥ï¼‰
         */
        async function getRandomItemWithUsername(array, username) {
            const hash = await sha256Hash(username);
            return array[(hash >>> 0) % array.length];
        }

        /**
         * ä»æ•°ç»„ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªå…ƒç´ 
         */
        function getRandomItem(array) {
            return array[Math.floor(Math.random() * array.length)];
        }

        /**
         * è·å–é€‰ä¸­çš„æ€§åˆ«
         */
        function getSelectedGender() {
            for (const radio of DOM.genderRadios) {
                if (radio.checked) return radio.value;
            }
            return null;
        }

        /**
         * ä»å…³é”®è¯åº“ä¸­è·å–éšæœºå…³é”®è¯ï¼ˆåŸºäºç”¨æˆ·åï¼Œå¼‚æ­¥ï¼‰
         */
        async function getRandomKeyword(gender, username) {
            return await getRandomItemWithUsername(KEYWORD_LIBRARY[gender], username.trim());
        }

        /**
         * åˆ‡æ¢é¡µé¢æ˜¾ç¤º
         */
        function switchPage(fromPage, toPage) {
            fromPage.style.display = 'none';
            toPage.style.display = 'block';
        }

        /**
         * æ˜¾ç¤ºå¼¹çª—
         */
        function showPopup(duration = CONFIG.POPUP_DURATION) {
            DOM.popup.style.display = 'block';
            setTimeout(() => {
                DOM.popup.style.display = 'none';
            }, duration);
        }

        /**
         * å¤åˆ¶æ–‡æœ¬åˆ°å‰ªè´´æ¿
         */
        async function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
                document.execCommand('copy');
                return true;
            } catch (err) {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                return false;
            } finally {
                document.body.removeChild(textarea);
            }
        }

        /**
         * è·³è½¬åˆ°QQç¾¤
         */
        function openQQGroup() {
            DOM.qqProtocolCheck.style.display = 'flex';
            
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = CONFIG.QQ_SCHEME;
            document.body.appendChild(iframe);
            
            setTimeout(() => {
                if (!document.hidden) {
                    window.location.href = CONFIG.QQ_UNIVERSAL_LINK;
                }
                document.body.removeChild(iframe);
                DOM.qqProtocolCheck.style.display = 'none';
            }, CONFIG.QQ_TIMEOUT);
        }

        // ========== è¡¨å•éªŒè¯ ==========
        
        /**
         * è·å–éªŒè¯é”™è¯¯ä¿¡æ¯
         */
        function getValidationError(nickname, genderSelected) {
            if (!nickname && !genderSelected) return "è¯·è¾“å…¥æ˜µç§°å¹¶é€‰æ‹©æ€§åˆ«";
            if (!nickname) return "è¯·è¾“å…¥æ˜µç§°";
            if (!genderSelected) return "è¯·é€‰æ‹©æ€§åˆ«";
            return "";
        }

        /**
         * æ£€æŸ¥è¡¨å•æœ‰æ•ˆæ€§å¹¶æ›´æ–°UI
         */
        function checkFormValidity() {
            const nickname = DOM.nicknameInput.value.trim();
            const genderSelected = Array.from(DOM.genderRadios).some(radio => radio.checked);
            const isValid = nickname && genderSelected;
            
            DOM.submitBtn.disabled = !isValid;
            DOM.errorMessage.textContent = isValid ? "" : getValidationError(nickname, genderSelected);
        }

        // ========== é¡µé¢æ§åˆ¶ ==========
        
        /**
         * æ˜¾ç¤ºç»“æœé¡µé¢
         */
        async function showResult() {
            const selectedGender = getSelectedGender();
            const nickname = DOM.nicknameInput.value.trim();
            const keyword = await getRandomKeyword(selectedGender, nickname);
            
            DOM.keywordDisplay.textContent = keyword;
            switchPage(DOM.inputPage, DOM.resultPage);
        }

        /**
         * è¿”å›åˆ°è¾“å…¥é¡µé¢
         */
        function goBack() {
            DOM.nicknameInput.value = '';
            DOM.genderRadios.forEach(radio => radio.checked = false);
            DOM.submitBtn.disabled = true;
            DOM.errorMessage.textContent = '';
            
            switchPage(DOM.resultPage, DOM.inputPage);
            DOM.nicknameInput.focus();
        }

        /**
         * å¤„ç†åŠ å…¥QQç¾¤
         */
        function handleJoinGroup() {
            copyToClipboard(CONFIG.QQ_GROUP_NUMBER);
            showPopup();
            openQQGroup();
        }

        // ========== äº‹ä»¶ç»‘å®š ==========
        
        DOM.nicknameInput.addEventListener('input', checkFormValidity);
        
        DOM.genderRadios.forEach(radio => {
            radio.addEventListener('change', checkFormValidity);
        });
        
        DOM.submitBtn.addEventListener('click', showResult);
        DOM.backBtn.addEventListener('click', goBack);
        DOM.popupClose.addEventListener('click', () => {
            DOM.popup.style.display = 'none';
        });

        // ä½¿ç”¨äº‹ä»¶å§”æ‰˜å¤„ç†ä¸¤ä¸ªåŠ å…¥ç¾¤æŒ‰é’®
        document.addEventListener('click', (e) => {
            if (e.target.closest('.join-group-btn')) {
                handleJoinGroup();
            }
        });
        
        // å›è½¦é”®æäº¤åŠŸèƒ½
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Enter' && !DOM.submitBtn.disabled && DOM.inputPage.style.display !== 'none') {
                showResult();
            }
        });

        // åˆå§‹åŒ–
        checkFormValidity();
    </script>
</body>
</html>
